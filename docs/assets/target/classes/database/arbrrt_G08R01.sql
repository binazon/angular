USE RefReport; 
delete from T_ENTITY_ATTRIBUTE where NAME='hasCos' and VALUE='false';
update T_REPORTING_GROUP set GROUPING_VALUE=CONCAT(GROUPING_VALUE, "_||_") WHERE GROUPING_CRITERIA='communityCodesORcustomerCodes';
update T_REPORTING_GROUP set GROUPING_CRITERIA='communityCodes_||_customerCodes_||_eid' WHERE GROUPING_CRITERIA='communityCodesORcustomerCodes';

CREATE TABLE t_tmp_shadow_site (`entity_pk` BIGINT(20) NOT NULL, PRIMARY KEY (`entity_pk`));
INSERT INTO t_tmp_shadow_site SELECT REPORTING_ENTITY_FK FROM TJ_REPORTING_ENTITY_TO_TYPE_AND_SUBTYPE WHERE subtype='SHADOW_SITE';
DELETE FROM T_ENTITY_ATTRIBUTE WHERE reporting_entity_fk IN (SELECT entity_pk FROM t_tmp_shadow_site);
DELETE FROM TJ_REPORTING_ENTITY_TO_TYPE_AND_SUBTYPE WHERE subtype = 'SHADOW_SITE';
DELETE FROM T_ENTITY_LINK WHERE REPORTING_ENTITY_SRC_FK IN (SELECT entity_pk FROM t_tmp_shadow_site);
DELETE FROM TJ_REPORT_CONFIG_TO_PARAM_TYPE WHERE param_type_fk = (SELECT pk FROM T_PARAM_TYPE WHERE entity_subtype = 'SHADOW_SITE');
DELETE FROM T_PARAM_TYPE WHERE entity_subtype = 'SHADOW_SITE';
DELETE FROM T_ENTITY_TYPE_AND_SUBTYPE WHERE SUBTYPE = 'SHADOW_SITE';
DELETE FROM TJ_REPORTING_GROUP_TO_ENTITIES where reporting_entity_fk IN (SELECT entity_pk FROM t_tmp_shadow_site);
DELETE FROM T_REPORTING_ENTITY WHERE pk IN (SELECT entity_pk FROM t_tmp_shadow_site);
DROP TABLE t_tmp_shadow_site;